<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
   <mapper namespace="com.kh.carlpion.mypage.model.dao.MypageMapper">
  
  <!-- 댓글 조회  -->
 	<select id="replyCheck"
 			resultType="com.kh.carlpion.mypage.model.dto.BoardDTO">
 	
 			SELECT * FROM (
 	
 			SELECT
 					'공지사항' AS boardType,
 					B.NOTICE_NO AS postNo,
 					B.TITLE,
 					B.COUNT,
 					C.CREATE_DATE AS createDate,
 					C.COMMENT
 			 FROM
 			 		CP_NT_COMMENT C
 			 JOIN
 			 	    CP_NOTICE B ON C.NOTICE_NO = B.NOTICE_NO
 			 JOIN
 			 		CP_USER U ON C.USER_NO = U.USER_NO
 		    WHERE
 		    		U.USERNAME = #{userName}
 		   	
 			UNION ALL	
 					
 			SELECT
 					'문의 게시판' AS boardType,
 					B.REPORT_NO AS postNo,
 					B.TITLE,
 					B.COUNT,
 					C.CREATE_DATE AS createDate,
 					C.COMMENT
 			 FROM			
 					CP_RP_COMMENT C 
 			 JOIN
 			 		CP_REPORT B ON C.REPORT_NO = B.REPORT_NO 
 			 JOIN
 			 		CP_USER U ON C.USER_NO = U.USER_NO	
 			 	
 			WHERE
 					U.USERNAME = #{userName}
 					
 					
 			UNION ALL	
 					
 			SELECT
 					'리뷰 게시판' AS boardType,
 					B.REVIEW_NO AS postNo,
 					B.TITLE,
 					B.COUNT,
 					C.CREATE_DATE AS createDate,
 					C.COMMENT
 			 FROM			
 					CP_RV_COMMENT C 
 			 JOIN
 			 		CP_REVIEW B ON C.REVIEW_NO = B.REVIEW_NO 
 			  JOIN
 			 		CP_USER U ON C.USER_NO = U.USER_NO
 			WHERE
 					U.USERNAME = #{userName}
 			)
 			 ORDER
 		       BY
 					createDate DESC;
 						
 	
 	</select>
 	
 	 <!-- 신고/문의 게시판 조회  -->
 	
 	
 	 <select id="inquiryCheck"
  		   resultType="com.kh.carlpion.mypage.model.dto.BoardDTO">
  		   
		  SELECT
		        U.USER_NO userNo,
		        R.REPORT_NO reportNo,
		        R.TITLE,
		        R.CONTENT,
		        R.CREATE_DATE createDate,
		        R.COUNT,
		        F.FILE_URL
		  FROM
		        CP_USER U
		  JOIN
		        CP_REPORT R ON R.USER_NO = U.USER_NO
		  JOIN
		        CP_RP_FILE F ON F.REPORT_NO = R.REPORT_NO 
		  WHERE 
		        U.USERNAME = #{userName}
		  ORDER BY
		        R.CREATE_DATE DESC
  
 	</select>
 	
 	<!-- 리뷰 게시판 조회  -->
 	
 	<select id="reviewCheck"
			resultType="com.kh.carlpion.mypage.model.dto.BoardDTO">
	
		 SELECT
		        U.USER_NO userNo,
		        R.REVIEW_NO reviewNo,
		        R.TITLE,
		        R.CONTENT,
		        R.CREATE_DATE createDate,
		        R.COUNT,
		        F.FILE_URL
		  FROM
		        CP_USER U
		  JOIN
		        CP_REVIEW R ON R.USER_NO = U.USER_NO
		  JOIN
		        CP_RV_FILE F ON F.REVIEW_NO = R.REVIEW_NO 
		  WHERE 
		        U.USERNAME = #{userName}
		  ORDER BY
		        R.CREATE_DATE DESC
  
	 	
	</select>
 	 
	<!-- 포인트 조회  -->
	
	<select id="pointCheck"
			resultType="com.kh.carlpion.mypage.model.dto.PointDTO">
			
		SELECT
			    P.USER_NO,
			    H.REVIEW_NO,
			    U.USERNAME,
			    U.REALNAME,
			    P.USER_LEVEL,
			    H.REASON,
			    H.POINT_CHANGE,
			    P.POINT,
			    H.CREATE_DATE
		FROM
		    	CP_POINT_HISTORY H
		JOIN
		    	CP_POINT P ON H.USER_NO = P.USER_NO
		JOIN
		   		CP_USER U ON P.USER_NO = U.USER_NO
		WHERE
		    	U.USERNAME = #{userName}
		ORDER 
		BY
		    	CREATE_DATE DESC
			
			
			</select>


	<select id="reservations"
			resultType="com.kh.carlpion.mypage.model.dto.ReservationsDTO">
			
 	SELECT
 			R.CAR_ID,
 			C.MODEL_NO,
 			I.PARKING_ID,
 			R.RESERVATION_NO,
 			R.RENTAL_DATE,
 			R.RETURN_DATE,
 			R.TOTAL_PRICE,
 			R.STATUS,
 			R.PAYMENT_COMPLETED_AT,
 			I.PARKING_TITLE,
 			I.PARKING_ADDR
 	FROM
 			CP_RENTAL_RESERVATION R
 	JOIN
 			CP_USER U ON U.USER_NO = R.USER_NO
 	JOIN
 			CP_RENTAL_CAR C ON R.CAR_ID = C.CAR_ID
 	JOIN
 			CP_PARKING_INFO I ON C.PARKING_ID = I.PARKING_ID
 	
 	WHERE
 			U.USER_NO = #{userNo}
 	ORDER
 		BY
 			RENTAL_DATE DESC
 			
 	</select>
 	
 	<select id="usedCars"
			resultType="com.kh.carlpion.mypage.model.dto.ReservationsDTO">
			
 	SELECT
 			R.CAR_ID,
 			C.MODEL_NO,
 			I.PARKING_ID,
 			R.RENTAL_DATE,
 			R.RETURN_DATE,
 			R.TOTAL_PRICE,
 			R.PAYMENT_COMPLETED_AT,
 			I.PARKING_TITLE,
 			I.PARKING_ADDR
 	FROM
 			CP_RENTAL_RESERVATION R
 	JOIN
 			CP_USER U ON U.USER_NO = R.USER_NO
 	JOIN
 			CP_RENTAL_CAR C ON R.CAR_ID = C.CAR_ID
 	JOIN
 			CP_PARKING_INFO I ON C.PARKING_ID = I.PARKING_ID
 	
 	WHERE
			U.USER_NO = #{userNo} 	
 	ORDER
 		BY
 			RENTAL_DATE DESC
 		
 	
 	</select>
 	
 	
   </mapper>
  
  